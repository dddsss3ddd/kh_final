<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Han">

	<insert id="t_in" parameterType="hbean">
		insert into test values(#{hval1},#{hval2})
	</insert>

	<insert id="insertAuc" parameterType="haucbean">
		insert into auction_item(
		auc_no,
		user_id,auc_info1,auc_info2,auc_title,
		auc_img1,auc_img2,auc_content,guarantee,
		guarantee_info, auc_price, auc_interval,
		auc_add, auc_start, auc_end, method, method_price
		)
		values(
		auction_item_no_seq.nextval,
		#{user_id},#{auc_info1},#{auc_info2},#{auc_title},
		#{auc_img1},#{auc_img2},#{auc_content},#{guarantee},
		#{guarantee_info}, #{auc_price}, #{auc_interval},
		sysdate,
		<if test="auto_date_s != null and auto_date_e != null ">
			sysdate,
			sysdate+1
		</if>
		<if test="auto_date_s == null and auto_date_e != null">
			TO_DATE(#{auc_start},'yyyy/mm/dd hh24:mi:ss'),
			TO_DATE(#{auc_start},'yyyy/mm/dd hh24:mi:ss')+1
		</if> 
		<if test="auto_date_s != null and auto_date_e == null">
			sysdate,
			sysdate+#{e_date}+#{e_hour}/24+#{e_min}/24/60
		</if> 
		<if test="auto_date_s == null and auto_date_e == null">
			TO_DATE(#{auc_start},'yyyy/mm/dd hh24:mi:ss'),
			TO_DATE(#{auc_start},'yyyy/mm/dd hh24:mi:ss')+#{e_date}+#{e_hour}/24+#{e_min}/24/60
		</if>
		,
		#{method}, #{method_price}
		)
	</insert>
	
	<select id="getdate" resultType="string">
		Select sysdate from dual
	</select>
	
	<select id="getconfuser" parameterType="string" resultType="string">
		select user_id from join001 where user_id=#{user_id}
	</select>

	<insert id="insertcons" parameterType="hconbean">
		insert into consignment
			(cons_no,cons_id,cons_title,cons_img1,cons_img2,
			cons_content,cons_gua,gua_info,cons_price,cons_date,cons_result1,cons_result2)
		values(
			cons_no_seq.nextval,#{cons_id},#{cons_title},
			#{cons_img1},#{cons_img2},#{cons_content},
			<choose>
				<when test="cons_gua == 'yes'">'yes',</when>
				<otherwise>'no',</otherwise>
			</choose>
			#{gua_info},#{cons_price},sysdate,'yet','yet'
		)
	</insert>
	
	<select id="getconslist" resultType="hconbean" parameterType="hconscondi">
		select * from (
			select rownum rnum,cons_no,cons_id,cons_title,cons_img1,cons_img2,
			cons_content,cons_gua,gua_info,cons_price,cons_date,cons_result1,
			cons_result1_date,cons_go_date,cons_go_time_f,cons_go_time_t,
			cons_go_content,cons_result2,cons_result2_date,cons_ant_price,
			cons_ans,cons_commit,cons_auc_no,auc_price,auc_interval
			from	(	select * from consignment
				
				<if test="search_condition=='id' and user_id != null">
					where cons_id=#{user_id}
				</if>
				<if test="search_condition=='viewing'">
					where cons_result1='yet'
				</if>
				<if test="search_condition=='identifying'">
					where cons_result1='accept'
					and cons_result2='yet'
				</if>
				<if test="search_condition=='consigning'">
					where cons_result1='accept'
					and cons_result2='accept'
					and cons_commit='yet'
				</if>
				<if test="search_condition=='conplete'">
					where cons_result1='accept'
					and cons_result2='accept'
					and cons_commit='accept'
				</if>

						order by cons_no desc))
		where rnum &gt;= ((#{page}-1)*6+1)
					and rnum &lt;= (#{page}*6)

	</select>
	
	<select id="getconslistno" resultType="int" parameterType="hconscondi">
		select count(*) from consignment
			<if test="search_condition=='id'">
				where cons_id=#{user_id}
			</if>
			<if test="search_condition=='viewing'">
				where cons_result1='yet'
			</if>
			<if test="search_condition=='identifying'">
				where cons_result1='accept'
				and cons_result2='yet'
			</if>
			<if test="search_condition=='consigning'">
				where cons_result1='accept'
				and cons_result2='accept'
				and cons_commit='yet'
			</if>
			<if test="search_condition=='conplete'">
				where cons_result1='accept'
				and cons_result2='accept'
				and cons_commit='accept'
			</if>
	</select>
	
	<select id="getconsdetail" parameterType="int" resultType="hconbean">
		select * from consignment where cons_no = #{int}
	</select>
	
	<select id="getdate_cons" resultType="string" parameterType="int">
		select cons_result1_date from consignment where cons_no=#{cons_no}
	</select>
	
	<delete id="consdel" parameterType="int">
		delete from consignment where cons_no=#{cons_no}
	</delete>
	
	<update id="consdataupdate" parameterType="hcubean">
		update consignment
		set
		
		
		<if test="button_info =='indentify_accept'">
			cons_result1='accept',
			cons_result1_date=sysdate
		</if>
		<if test="button_info =='indentify_deny'">
			cons_result1='deny',
			cons_result1_date=sysdate
		</if>
		<if test="button_info =='identify_date_select'">
			cons_go_date=#{cons_go_date},
			cons_go_time_f=to_number(#{cons_go_time_f}),
			cons_go_time_t=to_number(#{cons_go_time_t})
		</if>
		<if test="button_info=='ant_update'">
			cons_ant_price=to_number(trim(#{cons_ant_price})),
			cons_ans=#{cons_ans}
		</if>
		<if test="button_info=='ant_in_accept'">
			cons_result2='accept',
			cons_ant_price=to_number(trim(#{cons_ant_price})),
			cons_ans=#{cons_ans},
			cons_result2_date=sysdate
		</if>
		<if test="button_info=='ant_in_deny'">
			cons_result2='deny',
			cons_ant_price=to_number(trim(#{cons_ant_price})),
			cons_ans=#{cons_ans},
			cons_result2_date=sysdate
		</if>
		<if test="button_info=='cons_accept' or button_info=='cons_deny'">
			auc_price=to_number(trim(#{auc_price})),
			auc_interval=to_number(trim(#{auc_interval})),
			cons_commit=#{cons_commit}
		</if>
		where cons_no = #{cons_no}
	</update>
	
	<select id="consupdatereturn" parameterType="int" resultType="hcubean">
		select
			cons_no,cons_result1,cons_result1_date,cons_go_date,cons_go_time_f,cons_go_time_t,
			cons_go_content,cons_result2,cons_ant_price,cons_ans,cons_result2_date,
			auc_price,auc_interval
		from consignment where cons_no=#{cons_no}
	</select>
	<insert id="insertCat" parameterType="haucbean">
		insert into auction_category(auc_no,auc_category1) values(#{auc_no},#{auc_category1})
	</insert>
</mapper>
